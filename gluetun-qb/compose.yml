# VPN container with qBittorrent, Prowlarr, FlareSolverr
# Uses network_mode:container which is not supported in Swarm mode
# Run with: docker compose up -d (or make gluetun-qb)
#
# Required .env file variables:
#   WIREGUARD_PRIVATE_KEY=<your-mullvad-private-key>
#   WIREGUARD_ADDRESSES=<your-mullvad-address>/32

services:
  gluetun:
    image: qmcgaw/gluetun:v3.41.0
    container_name: gluetun_mullvad
    cap_add:
      - NET_ADMIN
    ports:
      - 6081:6881 # qb
      - 6081:6881/udp # qb
      - 6011:6011 # qb
      - 9696:9696 # Prowlarr
      - 8191:8191 # FlareSolverr
    env_file:
      - .env
    environment:
      VPN_SERVICE_PROVIDER: mullvad
      VPN_TYPE: wireguard
      SERVER_CITIES: stockholm
    volumes:
      - /home/william/Documents/hosting/gluetun-vpn/volume:/gluetun
    networks:
      - default
      - proxy-net
    restart: unless-stopped
  flaresolverr:
    # DockerHub mirror flaresolverr/flaresolverr:latest
    image: ghcr.io/flaresolverr/flaresolverr:v3.4.6
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=info
      - LOG_HTML=false
      - CAPTCHA_SOLVER=none
      - TZ=Europe/Stockholm
    network_mode: "container:gluetun_mullvad"
    restart: unless-stopped
    depends_on:
      gluetun:
        condition: service_healthy
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:nightly-version-2.3.2.5245
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=CET
    volumes:
      - /home/william/Documents/hosting/prowlarr/data:/config
    network_mode: "container:gluetun_mullvad"
    restart: unless-stopped
    depends_on:
      gluetun:
        condition: service_healthy
  qbittorrent:
    image: linuxserver/qbittorrent:5.1.4
    container_name: qbittorrent
    environment:
      PUID: 1000
      PGID: 1000
      TZ: Europe/Stockholm
      WEBUI_PORT: 6011
      DOCKER_MODS: ghcr.io/vuetorrent/vuetorrent-lsio-mod:latest
    volumes:
      - /home/william/Documents/hosting/qbittorent/config:/config
      - /media/sambashare:/downloads
    network_mode: "container:gluetun_mullvad"
    restart: unless-stopped
    depends_on:
      gluetun:
        condition: service_healthy

networks:
  default:
    # bridge network for container:gluetun networking
  proxy-net:
    external: true
