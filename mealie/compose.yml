networks:
  proxy-net:
    external: true

services:
  mealie:
    image: ghcr.io/mealie-recipes/mealie:v2.8.0
    container_name: mealie
    restart: always
    ports:
        - "9925:9000" # 
    deploy:
      resources:
        limits:
          memory: 1000M # 
    networks:
     - proxy-net
    volumes:
      - mealie-data:/app/data/
    environment:
      # Set Backend ENV Variables Here
      ALLOW_SIGNUP: true
      PUID: 1000
      PGID: 1000
      TZ: Sweden/Stockholm
      MAX_WORKERS: 1
      WEB_CONCURRENCY: 1
      BASE_URL: ${DOMAIN}
      # OIDC auth flow
      OIDC_AUTH_ENABLED: false
      OIDC_PROVIDER_NAME: authentik
      OIDC_CONFIGURATION_URL: ${OIDC_CONFIGURATION_URL}
      OIDC_CLIENT_ID: ${OIDC_CLIENT_ID}
      OIDC_CLIENT_SECRET: ${OIDC_CLIENT_SECRET}
      OIDC_SIGNUP_ENABLED: true
      OIDC_USER_GROUP: ${OIDC_USER_GROUP}
      OIDC_ADMIN_GROUP: ${OIDC_ADMIN_GROUP}
      OIDC_AUTO_REDIRECT: false   # Optional: The login page will be bypassed and you will be sent directly to your Identity Provider.
      OIDC_REMEMBER_ME: true     # Optional: By setting this value to true, a session will be extended as if "Remember Me" was checked
      FORWARDED_ALLOW_IPS: ${FORWARDED_ALLOW_IPS}
    dns:
     - ${DNS}
     - "1.1.1.1"
volumes:
  mealie-data:
    name: "mealie_mealie-data"
